name: Deployment

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Make composer executable
        run: pwd

      - name: Run deployment script
        run: |
          echo "Starting deployment..."
          export COMPOSER_HOME=/home/kejadigital/.composer
          /home/kejadigital/www/test.kejadigital.com/composer install --no-dev --optimize-autoloader
          php /home/kejadigital/www/test.kejadigital.com/artisan key:generate
          php /home/kejadigital/www/test.kejadigital.com/artisan config:cache
          php /home/kejadigital/www/test.kejadigital.com/artisan route:cache
          php /home/kejadigital/www/test.kejadigital.com/artisan view:cache
          echo "Deployment finished."
